<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¾¹AI:ì‡¼ì¼€ì´ìŠ¤ - ë„ë§¤ê¾¹ ì „ìš©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; letter-spacing: -0.01em; }
        :root { --dome-green: #329946; }
        .bg-dome { background-color: var(--dome-green); }
        .text-dome { color: var(--dome-green); }
        .selected-card { outline: 2px solid var(--dome-green) !important; outline-offset: -2px; background-color: #f0fdf4 !important; transform: translateY(-5px); transition: all 0.2s; }
        .check-badge { display: none; position: absolute; top: 12px; right: 12px; z-index: 20; width: 28px; height: 28px; background: var(--dome-green); color: white; border-radius: 50%; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .selected-card .check-badge { display: flex; animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .tab-active { border-bottom: 3px solid var(--dome-green); color: var(--dome-green); font-weight: 800; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-48">

    <header class="bg-white border-b px-6 h-16 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-dome text-white rounded-xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-wand-magic-sparkles text-xl"></i></div>
            <h1 class="text-xl font-black text-gray-900 tracking-tighter">ê¾¹AI: <span class="text-dome">ì‡¼ì¼€ì´ìŠ¤</span></h1>
        </div>
        <button onclick="location.reload()" class="bg-gray-100 text-gray-600 px-5 py-2 rounded-xl text-xs font-black">ì´ˆê¸°í™”</button>
    </header>

    <main class="max-w-6xl mx-auto p-6 md:p-10 text-center">
        <div id="search-section" class="max-w-2xl mx-auto mb-10">
            <div class="flex border-b mb-8 text-sm">
                <button id="tab-id" onclick="switchTab('id')" class="flex-1 py-4 font-bold tab-active">ê³µê¸‰ì‚¬ IDë¡œ ì°¾ê¸°</button>
                <button id="tab-no" onclick="switchTab('no')" class="flex-1 py-4 font-bold text-gray-400">ìƒí’ˆë²ˆí˜¸ë¡œ ì°¾ê¸°</button>
            </div>

            <div class="relative bg-white p-2 rounded-2xl shadow-sm border-2 border-gray-100 flex gap-2">
                <input id="search-input" type="text" placeholder="ê³µê¸‰ì‚¬ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeyup="if(window.event.keyCode==13){instantSearch()}" class="flex-1 outline-none p-3 font-bold bg-transparent text-lg">
                <button id="search-btn" onclick="instantSearch()" class="bg-dome text-white px-8 py-3 rounded-xl font-black shadow-lg hover:brightness-105 transition-all">ì¡°íšŒí•˜ê¸°</button>
            </div>
            <p class="text-gray-400 text-[11px] mt-4 font-medium italic">ë„ë§¤ê¾¹(dome) ìƒí’ˆ ì „ìš© ë¼ì´ë¸Œ ëª¨ë“œ í™œì„±í™”ë¨</p>
        </div>

        <div id="editor-step" class="hidden text-left">
            <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl border shadow-sm">
                <h3 class="font-black text-2xl text-gray-900 tracking-tight">'<span id="search-result-keyword" class="text-dome"></span>' ê²€ìƒ‰ ê²°ê³¼</h3>
            </div>
            <div id="display-area" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
        </div>

        <div id="showcase-view" class="hidden">
            <div class="bg-white p-4 md:p-14 rounded-[3rem] shadow-2xl border flex flex-col items-center">
                <div id="table-container" style="width: 100%;"></div>
            </div>
            <div class="mt-12 flex justify-center gap-4">
                <button onclick="goBackToEditor()" class="border-2 border-gray-900 px-8 py-4 rounded-2xl font-bold">ëŒì•„ê°€ê¸°</button>
                <button onclick="copyTableHtml()" class="bg-dome text-white px-10 py-4 rounded-2xl font-black shadow-xl">HTML ì½”ë“œ ë³µì‚¬</button>
            </div>
        </div>
    </main>

    <footer id="action-bar" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-gray-900 text-white rounded-[2.5rem] p-5 shadow-2xl flex flex-col gap-4 hidden translate-y-60 transition-all duration-500 z-40">
        <div class="flex items-center justify-between px-3">
            <div class="flex items-center gap-4">
                <span id="selected-count" class="bg-dome text-white w-10 h-10 rounded-full flex items-center justify-center font-black text-xl">0</span>
                <p class="font-bold text-sm text-gray-300">ê°œ ì„ íƒë¨</p>
            </div>
            <button onclick="generateTableShowcase()" class="bg-dome text-white px-8 py-3.5 rounded-2xl font-black text-sm">ì‡¼ì¼€ì´ìŠ¤ ìƒì„±</button>
        </div>
        <div id="selected-list" class="flex gap-3 overflow-x-auto px-2 pb-2 scroll-smooth"></div>
    </footer>

   <script>
    const DOME_AID = "e43154deef698c88c994ca22cb34a457"; 
    let searchMode = 'id';
    let selectedItems = [];
    let fetchedProducts = [];

    // âš ï¸ ì´ë¯¸ í™•ì¸í•˜ì‹  ê·¸ URLì…ë‹ˆë‹¤.
    const MY_PROXY_URL = "https://script.google.com/macros/s/AKfycbw3eaQUNVEUKmhynrXGRImm2_BzJ0oZ4wpDuyS1Ars-bwmpLo3IQvT13JNbBt1pxxxLgg/exec"; 

    function switchTab(mode) {
        searchMode = mode;
        const input = document.getElementById('search-input');
        input.value = '';
        document.getElementById('tab-id').className = mode === 'id' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
        document.getElementById('tab-no').className = mode === 'no' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
        input.placeholder = mode === 'id' ? "ê³µê¸‰ì‚¬ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" : "ìƒí’ˆë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”";
    }

    async function instantSearch() {
        const input = document.getElementById('search-input');
        const keyword = input.value.trim();
        if (!keyword) { alert("ì…ë ¥ê°’ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

        document.getElementById('search-btn').innerText = "í†µì‹  ì¤‘...";

        try {
            let targetUrl = "";
            if (searchMode === 'id') {
                targetUrl = `https://domeggook.com/ssl/api/?ver=4.1&mode=getItemList&aid=${DOME_AID}&om=json&id=${keyword}&market=dome&sz=100`;
            } else {
                targetUrl = `https://domeggook.com/ssl/api/?ver=4.5&mode=getItemView&aid=${DOME_AID}&om=json&no=${keyword}`;
            }

            // âš¡ êµ¬ê¸€ í”„ë¡ì‹œ ì „ìš© í†µì‹  ë°©ì‹
            const response = await fetch(`${MY_PROXY_URL}?url=${encodeURIComponent(targetUrl)}`);
            const data = await response.json(); // ğŸ‘ˆ ë¡œê·¸ í™•ì¸ ê²°ê³¼, ë°”ë¡œ json()ìœ¼ë¡œ ë°›ëŠ” ê²Œ ì •ë‹µì…ë‹ˆë‹¤!

            if (data.status !== "OK") {
                alert(`ì‹¤íŒ¨: ${data.message || "ê²°ê³¼ ì—†ìŒ"}`);
                return;
            }

            // ë°ì´í„° ê°€ê³µ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
            if (searchMode === 'id') {
                if (!data.list || !data.list.item) { alert("ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
                const items = Array.isArray(data.list.item) ? data.list.item : [data.list.item];
                fetchedProducts = items.map(item => ({
                    no: item.no,
                    title: item.title,
                    price: parseInt(item.price).toLocaleString(),
                    img: item.thumb.replace('http://', 'https://')
                }));
            } else {
                fetchedProducts = [{
                    no: data.basis.no,
                    title: data.basis.title,
                    price: parseInt(data.price.dome || data.price.supply).toLocaleString(),
                    img: data.thumb.small.replace('http://', 'https://')
                }];
            }

            document.getElementById('search-result-keyword').innerText = keyword;
            document.getElementById('search-section').classList.add('hidden');
            document.getElementById('editor-step').classList.remove('hidden');
            renderResults();

        } catch (err) {
            console.error("Error Detail:", err);
            alert("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì•± ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        } finally {
            document.getElementById('search-btn').innerText = "ì¡°íšŒí•˜ê¸°";
        }
    }

    // --- ì´í•˜ ë Œë”ë§ ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼) ---
    function renderResults() {
        document.getElementById('display-area').innerHTML = fetchedProducts.map(p => {
            const isSelected = selectedItems.find(item => item.no === p.no);
            return `
            <div class="relative bg-white border border-gray-200 rounded-2xl p-3 cursor-pointer ${isSelected ? 'selected-card' : ''}" onclick="toggleItem('${p.no}', this)">
                <div class="check-badge"><i class="fa-solid fa-check text-xs"></i></div>
                <img src="${p.img}" class="w-[150px] h-[150px] object-cover rounded-xl mb-3 mx-auto block">
                <p class="text-[10px] text-gray-400 font-bold">#${p.no}</p>
                <p class="text-[13px] font-bold text-gray-800 line-clamp-2 h-10 leading-tight">${p.title}</p>
                <p class="text-dome font-black text-sm">${p.price}ì›</p>
            </div>`;
        }).join('');
    }

    function toggleItem(no, el) {
        const index = selectedItems.findIndex(i => i.no === no);
        if(index > -1) { 
            selectedItems.splice(index, 1); 
            el.classList.remove('selected-card'); 
        } else { 
            selectedItems.push(fetchedProducts.find(p => p.no === no)); 
            el.classList.add('selected-card'); 
        }
        updateBar();
    }

    function updateBar() {
        const bar = document.getElementById('action-bar');
        document.getElementById('selected-count').innerText = selectedItems.length;
        if(selectedItems.length > 0) {
            bar.classList.remove('hidden', 'translate-y-60');
            document.getElementById('selected-list').innerHTML = selectedItems.map(item => `<div class="w-12 h-12 rounded-lg overflow-hidden border border-white/20 flex-shrink-0"><img src="${item.img}" class="w-full h-full object-cover"></div>`).join('');
        } else { bar.classList.add('translate-y-60'); }
    }

    function generateTableShowcase() {
        document.getElementById('editor-step').classList.add('hidden');
        document.getElementById('action-bar').classList.add('hidden');
        document.getElementById('showcase-view').classList.remove('hidden');
        
        let html = `<div style="width:100%;max-width:1100px;margin:0 auto;background:#ffffff;padding:20px 0;text-align:center;">
            <h2 style="font-size:28px;font-weight:800;margin-bottom:25px;text-align:center;">ì¶”ì²œ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸</h2>
            <div style="font-size:0; text-align:left;">`; 
        selectedItems.forEach(item => {
            html += `
            <div style="display:inline-block; vertical-align:top; width:46%; max-width:170px; margin:8px; border:1px solid #eee; border-radius:12px; overflow:hidden;">
                <a href="https://domeggook.com/${item.no}" target="_blank" style="text-decoration:none;">
                    <img src="${item.img}" style="width:100%; aspect-ratio:1/1; object-fit:cover;">
                    <div style="padding:10px;">
                        <div style="font-size:12px; color:#333; font-weight:bold; height:34px; overflow:hidden;">${item.title}</div>
                        <div style="font-size:16px; color:#329946; font-weight:800; margin-top:8px;">${item.price}ì›</div>
                    </div>
                </a>
            </div>`;
        });
        html += `</div></div>`;
        document.getElementById('table-container').innerHTML = html;
    }

    function goBackToEditor() { document.getElementById('showcase-view').classList.add('hidden'); document.getElementById('editor-step').classList.remove('hidden'); updateBar(); }
    function copyTableHtml() { navigator.clipboard.writeText(document.getElementById('table-container').innerHTML.trim()).then(() => alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')); }
</script>
</body>
</html>
