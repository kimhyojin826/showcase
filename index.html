<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>꾹AI:쇼케이스 - 도매꾹 전용</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; letter-spacing: -0.01em; }
        :root { --dome-green: #329946; }
        .bg-dome { background-color: var(--dome-green); }
        .text-dome { color: var(--dome-green); }
        .selected-card { outline: 2px solid var(--dome-green) !important; outline-offset: -2px; background-color: #f0fdf4 !important; transform: translateY(-5px); transition: all 0.2s; }
        .check-badge { display: none; position: absolute; top: 12px; right: 12px; z-index: 20; width: 28px; height: 28px; background: var(--dome-green); color: white; border-radius: 50%; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .selected-card .check-badge { display: flex; animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .tab-active { border-bottom: 3px solid var(--dome-green); color: var(--dome-green); font-weight: 800; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-48">

    <header class="bg-white border-b px-6 h-16 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-dome text-white rounded-xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-wand-magic-sparkles text-xl"></i></div>
            <h1 class="text-xl font-black text-gray-900 tracking-tighter">꾹AI: <span class="text-dome">쇼케이스</span></h1>
        </div>
        <button onclick="location.reload()" class="bg-gray-100 text-gray-600 px-5 py-2 rounded-xl text-xs font-black">초기화</button>
    </header>

    <main class="max-w-6xl mx-auto p-6 md:p-10 text-center">
        <div id="search-section" class="max-w-2xl mx-auto mb-10">
            <div class="flex border-b mb-8 text-sm">
                <button id="tab-id" onclick="switchTab('id')" class="flex-1 py-4 font-bold tab-active">공급사 ID로 찾기</button>
                <button id="tab-no" onclick="switchTab('no')" class="flex-1 py-4 font-bold text-gray-400">상품번호로 찾기</button>
            </div>

            <div class="relative bg-white p-2 rounded-2xl shadow-sm border-2 border-gray-100 flex gap-2">
                <input id="search-input" type="text" placeholder="공급사 아이디를 입력하세요" onkeyup="if(window.event.keyCode==13){instantSearch()}" class="flex-1 outline-none p-3 font-bold bg-transparent text-lg">
                <button id="search-btn" onclick="instantSearch()" class="bg-dome text-white px-8 py-3 rounded-xl font-black shadow-lg hover:brightness-105 transition-all">조회하기</button>
            </div>
        </div>

        <div id="editor-step" class="hidden text-left">
            <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl border shadow-sm">
                <h3 class="font-black text-2xl text-gray-900 tracking-tight">'<span id="search-result-keyword" class="text-dome"></span>' 검색 결과</h3>
            </div>
            <div id="display-area" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
        </div>

        <div id="showcase-view" class="hidden">
            <div class="bg-white p-4 md:p-14 rounded-[3rem] shadow-2xl border flex flex-col items-center">
                <div id="table-container" style="width: 100%;"></div>
            </div>
            <div class="mt-12 flex justify-center gap-4">
                <button onclick="goBackToEditor()" class="border-2 border-gray-900 px-8 py-4 rounded-2xl font-bold">돌아가기</button>
                <button onclick="copyTableHtml()" class="bg-dome text-white px-10 py-4 rounded-2xl font-black shadow-xl">HTML 코드 복사</button>
            </div>
        </div>
    </main>

    <footer id="action-bar" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-gray-900 text-white rounded-[2.5rem] p-5 shadow-2xl flex flex-col gap-4 hidden translate-y-60 transition-all duration-500 z-40">
        <div class="flex items-center justify-between px-3">
            <div class="flex items-center gap-4">
                <span id="selected-count" class="bg-dome text-white w-10 h-10 rounded-full flex items-center justify-center font-black text-xl">0</span>
                <p class="font-bold text-sm text-gray-300">개 선택됨</p>
            </div>
            <button onclick="generateTableShowcase()" class="bg-dome text-white px-8 py-3.5 rounded-2xl font-black text-sm">쇼케이스 생성</button>
        </div>
        <div id="selected-list" class="flex gap-3 overflow-x-auto px-2 pb-2 scroll-smooth"></div>
    </footer>

    <script>
        const DOME_AID = "e43154deef698c88c994ca22cb34a457"; 
        const MY_PROXY_URL = "https://script.google.com/macros/s/AKfycby5ybTnwIBtjVH5EetX6ID3fsTfzB7wnniattST_6zUObG6qpshJv7Q_aaU2RASdorq/exec"; 
        
        let searchMode = 'id';
        let selectedItems = [];
        let fetchedProducts = [];

        function switchTab(mode) {
            searchMode = mode;
            const input = document.getElementById('search-input');
            input.value = '';
            document.getElementById('tab-id').className = mode === 'id' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
            document.getElementById('tab-no').className = mode === 'no' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
            input.placeholder = mode === 'id' ? "공급사 아이디를 입력하세요" : "상품번호를 입력하세요";
        }

        async function instantSearch() {
            const input = document.getElementById('search-input');
            const keyword = input.value.trim();
            if (!keyword) { alert("입력값이 없습니다."); return; }
            document.getElementById('search-btn').innerText = "데이터 분석 중...";

            try {
                // 핵심: 사용자님이 설명하신 대로 mode와 파라미터를 정확히 구분합니다.
                let targetUrl = (searchMode === 'id') 
                    ? `https://domeggook.com/ssl/api/?ver=4.5&mode=getItemList&aid=${DOME_AID}&om=json&id=${keyword}&sz=100`
                    : `https://domeggook.com/ssl/api/?ver=4.5&mode=getItemView&aid=${DOME_AID}&om=json&no=${keyword}`;

                const response = await fetch(`${MY_PROXY_URL}?url=${encodeURIComponent(targetUrl)}`);
                const data = await response.json();
                
                fetchedProducts = [];

                if (searchMode === 'no') {
                    // [상품번호 검색 시] getItemView의 응답 처리
                    const item = data.basis || data.item;
                    if (item && (item.no || item.item_no)) {
                        fetchedProducts.push({
                            no: item.no || item.item_no,
                            title: item.title,
                            price: parseInt(data.price?.dome || item.price || 0).toLocaleString(),
                            img: (data.thumb?.big || item.thumb || "").replace('http://', 'https://')
                        });
                    }
                } else {
                    // [공급사 ID 검색 시] getItemList의 응답 처리
                    const list = data.list?.item;
                    if (list) {
                        const items = Array.isArray(list) ? list : [list];
                        fetchedProducts = items.map(i => ({
                            no: i.no,
                            title: i.title,
                            price: parseInt(i.price || 0).toLocaleString(),
                            img: (i.thumb || "").replace('http://', 'https://')
                        }));
                    }
                }

                if (fetchedProducts.length > 0) {
                    document.getElementById('search-result-keyword').innerText = keyword;
                    document.getElementById('search-section').classList.add('hidden');
                    document.getElementById('editor-step').classList.remove('hidden');
                    renderResults();
                } else {
                    alert("검색 결과가 없습니다. 입력값과 탭 선택을 확인해주세요.");
                }
            } catch (err) {
                alert("통신 오류가 발생했습니다. 구글 앱 스크립트 설정을 확인해주세요.");
            } finally {
                document.getElementById('search-btn').innerText = "조회하기";
            }
        }

        function renderResults() {
            document.getElementById('display-area').innerHTML = fetchedProducts.map(p => {
                const isSelected = selectedItems.find(item => item.no === p.no);
                return `
                <div class="relative bg-white border border-gray-200 rounded-2xl p-3 cursor-pointer ${isSelected ? 'selected-card' : ''}" onclick="toggleItem('${p.no}', this)">
                    <div class="check-badge"><i class="fa-solid fa-check text-xs"></i></div>
                    <img src="${p.img}" class="w-[150px] h-[150px] object-cover rounded-xl mb-3 mx-auto block">
                    <p class="text-[10px] text-gray-400 font-bold">#${p.no}</p>
                    <p class="text-[13px] font-bold text-gray-800 line-clamp-2 h-10 leading-tight">${p.title}</p>
                    <p class="text-dome font-black text-sm">${p.price}원</p>
                </div>`;
            }).join('');
        }

        function toggleItem(no, el) {
            const index = selectedItems.findIndex(i => i.no === no);
            if(index > -1) { 
                selectedItems.splice(index, 1); 
                el.classList.remove('selected-card'); 
            } else { 
                selectedItems.push(fetchedProducts.find(p => p.no === no)); 
                el.classList.add('selected-card'); 
            }
            updateBar();
        }

        function updateBar() {
            const bar = document.getElementById('action-bar');
            document.getElementById('selected-count').innerText = selectedItems.length;
            if(selectedItems.length > 0) {
                bar.classList.remove('hidden', 'translate-y-60');
                document.getElementById('selected-list').innerHTML = selectedItems.map(item => `<div class="w-12 h-12 rounded-lg overflow-hidden border border-white/20 flex-shrink-0"><img src="${item.img}" class="w-full h-full object-cover"></div>`).join('');
            } else { bar.classList.add('translate-y-60'); }
        }

        function generateTableShowcase() {
            document.getElementById('editor-step').classList.add('hidden');
            document.getElementById('action-bar').classList.add('hidden');
            document.getElementById('showcase-view').classList.remove('hidden');
            let html = `<div style="width:100%;max-width:1100px;margin:0 auto;background:#ffffff;padding:20px 0;text-align:center;">
                <h2 style="font-size:24px;font-weight:800;margin-bottom:25px;text-align:center;">추천 상품 리스트</h2>
                <div style="font-size:0; text-align:left;">`; 
            selectedItems.forEach(item => {
                html += `
                <div style="display:inline-block; vertical-align:top; width:46%; max-width:180px; margin:8px; border:1px solid #eee; border-radius:12px; overflow:hidden;">
                    <a href="https://domeggook.com/${item.no}" target="_blank" style="text-decoration:none;">
                        <img src="${item.img}" style="width:100%; aspect-ratio:1/1; object-fit:cover;">
                        <div style="padding:10px;">
                            <div style="font-size:12px; color:#333; font-weight:bold; height:34px; overflow:hidden;">${item.title}</div>
                            <div style="font-size:16px; color:#329946; font-weight:800; margin-top:8px;">${item.price}원</div>
                        </div>
                    </a>
                </div>`;
            });
            html += `</div></div>`;
            document.getElementById('table-container').innerHTML = html;
        }

        function goBackToEditor() { document.getElementById('showcase-view').classList.add('hidden'); document.getElementById('editor-step').classList.remove('hidden'); updateBar(); }
        function copyTableHtml() { navigator.clipboard.writeText(document.getElementById('table-container').innerHTML.trim()).then(() => alert('복사되었습니다!')); }
    </script>
</body>
</html>
