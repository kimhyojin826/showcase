<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>꾹AI:쇼케이스 - 최종 베이스캠프</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; letter-spacing: -0.01em; }
        :root { --dome-green: #329946; }
        .bg-dome { background-color: var(--dome-green); }
        .text-dome { color: var(--dome-green); }
        /* 선택 효과: 2px 강조 테두리 */
        .selected-card { outline: 2px solid var(--dome-green) !important; outline-offset: -2px; background-color: #f0fdf4 !important; transform: translateY(-5px); transition: all 0.2s; z-index: 10; }
        .check-badge { display: none; position: absolute; top: 12px; right: 12px; z-index: 20; width: 28px; height: 28px; background: var(--dome-green); color: white; border-radius: 50%; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .selected-card .check-badge { display: flex; animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .tab-active { border-bottom: 3px solid var(--dome-green); color: var(--dome-green); font-weight: 800; }
        /* 스크롤바 커스텀 */
        #selected-list::-webkit-scrollbar { height: 6px; }
        #selected-list::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-48">

    <header class="bg-white border-b px-6 h-16 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-dome text-white rounded-xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-wand-magic-sparkles text-xl"></i></div>
            <h1 class="text-xl font-black text-gray-900 tracking-tighter">꾹AI: <span class="text-dome">쇼케이스</span></h1>
        </div>
        <button onclick="location.reload()" class="hidden bg-gray-100 text-gray-600 px-5 py-2 rounded-xl text-xs font-black hover:bg-gray-200 transition-colors" id="restart-btn">새로고침</button>
    </header>

    <main class="max-w-6xl mx-auto p-6 md:p-10 text-center">
        <div id="search-section" class="max-w-2xl mx-auto mb-10">
            <div class="flex border-b mb-6 text-sm text-center">
                <button id="tab-id" onclick="switchTab('id')" class="flex-1 py-4 font-bold tab-active">공급사 ID 조회</button>
                <button id="tab-no" onclick="switchTab('no')" class="flex-1 py-4 font-bold text-gray-400">상품번호 조회</button>
            </div>
            <div class="relative bg-white p-2 rounded-2xl shadow-sm border-2 border-gray-100 flex gap-2">
                <input id="search-input" type="text" placeholder="아이디를 입력하세요" onkeyup="if(window.event.keyCode==13){instantSearch()}" class="flex-1 outline-none p-3 font-bold bg-transparent text-lg">
                <button id="search-btn" onclick="instantSearch()" class="bg-dome text-white px-8 py-3 rounded-xl font-black shadow-lg hover:brightness-110 transition-all">조회하기</button>
            </div>
            <p id="input-hint" class="text-[12px] text-gray-500 mt-3 font-bold text-left px-2">※ 공급사 아이디를 입력하세요 (EUC-KR 호환 문자만 가능).</p>
        </div>

        <div id="editor-step" class="hidden">
            <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl border shadow-sm text-left">
                <div>
                    <h3 class="font-black text-2xl text-gray-900 tracking-tight">
                        '<span id="search-result-keyword" class="text-dome"></span>' 상품 리스트
                    </h3>
                    <p class="text-xs text-gray-400 font-bold mt-1">※ 도매꾹 실시간 데이터를 정상적으로 수신하였습니다.</p>
                </div>
            </div>
            <div id="display-area" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
        </div>

        <div id="showcase-view" class="hidden">
            <div class="bg-white p-4 md:p-14 rounded-[3rem] shadow-2xl border flex flex-col items-center">
                <div id="table-container" style="width: 100%; min-width: 320px;"></div>
            </div>
            <div class="mt-12 flex justify-center gap-4">
                <button onclick="goBackToEditor()" class="border-2 border-gray-900 px-8 py-4 rounded-2xl font-bold hover:bg-gray-50">리스트로 돌아가기</button>
                <button id="copy-btn" onclick="copyTableHtml()" class="bg-dome text-white px-10 py-4 rounded-2xl font-black shadow-xl hover:brightness-110">HTML 코드 복사하기</button>
            </div>
        </div>
    </main>

    <footer id="action-bar" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-gray-900 text-white rounded-[2.5rem] p-5 shadow-2xl flex flex-col gap-4 hidden translate-y-60 transition-all duration-500 z-40 border border-white/10">
        <div class="flex items-center justify-between px-3">
            <div class="flex items-center gap-4 text-left">
                <span id="selected-count" class="bg-dome text-white w-10 h-10 rounded-full flex items-center justify-center font-black text-xl shadow-lg">0</span>
                <p class="font-bold text-sm text-gray-300">개의 상품이 선택됨</p>
            </div>
            <button onclick="generateTableShowcase()" class="bg-dome text-white px-8 py-3.5 rounded-2xl font-black text-sm shadow-lg hover:brightness-110 transition-all">쇼케이스 생성</button>
        </div>
        <div id="selected-list" class="flex gap-3 overflow-x-auto px-2 pb-2 scroll-smooth"></div>
    </footer>

    <script>
        // 발급받으신 AID를 여기에 입력하세요
        const DOME_AID = "e43154deef698c88c994ca22cb34a457"; 
        
        let searchMode = 'id';
        let selectedItems = [];
        let fetchedProducts = [];
        let isApiLoading = false; // 도매꾹 서비스 보호를 위한 로딩 락

        function switchTab(mode) {
            searchMode = mode;
            const input = document.getElementById('search-input');
            const hint = document.getElementById('input-hint');
            input.value = '';
            document.getElementById('tab-id').className = mode === 'id' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
            document.getElementById('tab-no').className = mode === 'no' ? 'flex-1 py-4 font-bold tab-active' : 'flex-1 py-4 font-bold text-gray-400';
            input.placeholder = mode === 'id' ? "아이디를 입력하세요" : "상품번호를 입력하세요";
            hint.innerText = mode === 'id' ? "※ 공급사 아이디를 입력하세요 (EUC-KR 호환 문자만)." : "※ 상품번호를 입력하세요.";
            input.focus();
        }

        async function instantSearch() {
            if (isApiLoading) return; // 중복 호출 방지 (분당 호출 제한 준수)

            const input = document.getElementById('search-input');
            const keyword = input.value.trim(); // 대소문자 보존을 위해 .toLowerCase() 제거

            if (!keyword) { alert("조회할 값을 입력해 주세요."); return; }

            // [안전장치] 도매꾹 서버 안정성을 위한 EUC-KR 범위 외 문자 필터링
            const safePattern = /^[a-zA-Z0-9가-힣\s\-\_\[\]\(\)\,\.]+$/;
            if (!safePattern.test(keyword)) {
                alert("도매꾹 서버 안정성을 위해 특수 기호나 이모지 검색은 제한됩니다.");
                return;
            }

            isApiLoading = true;
            const btn = document.getElementById('search-btn');
            btn.innerText = "조회 중...";
            btn.disabled = true;

            try {
                let apiUrl = "";
                if (searchMode === 'id') {
                    // v4.1 getItemList (공급사 상품 목록)
                    apiUrl = `https://domeggook.com/ssl/api/itemList.php?ver=4.1&mode=getItemList&aid=${DOME_AID}&om=json&id=${keyword}&sz=100&market=dome`;
                } else {
                    // v4.5 getItemView (개별 상품 상세)
                    apiUrl = `https://domeggook.com/ssl/api/itemList.php?ver=4.5&mode=getItemView&aid=${DOME_AID}&om=json&no=${keyword}`;
                }

                const response = await fetch(apiUrl);
                
                if (response.status === 429) {
                    alert("도매꾹 접속 허용량을 초과했습니다. 잠시 후 다시 시도해 주세요.");
                    return;
                }

                const data = await response.json();

                if (data.status !== "OK") {
                    alert(`조회 실패: ${data.message || "해당 정보가 없습니다."}`);
                    return;
                }

                // 응답 데이터 구조화
                if (searchMode === 'id') {
                    if(!data.list || !data.list.item) { alert("등록된 상품이 없습니다."); return; }
                    fetchedProducts = data.list.item.map(item => ({
                        no: item.no,
                        title: item.title,
                        price: parseInt(item.price).toLocaleString(),
                        img: (item.thumb || "").replace('http://', 'https://')
                    }));
                } else {
                    fetchedProducts = [{
                        no: data.basis.no,
                        title: data.basis.title,
                        price: parseInt(data.price.dome || data.price.supply).toLocaleString(),
                        img: data.thumb.small.replace('http://', 'https://')
                    }];
                }

                document.getElementById('search-result-keyword').innerText = keyword;
                document.getElementById('search-section').classList.add('hidden');
                document.getElementById('editor-step').classList.remove('hidden');
                document.getElementById('restart-btn').classList.remove('hidden');
                renderResults();

            } catch (err) {
                console.error(err);
                alert("통신 오류가 발생했습니다. API 허용 도메인 설정을 확인하세요.");
            } finally {
                isApiLoading = false;
                btn.innerText = "조회하기";
                btn.disabled = false;
            }
        }

        function renderResults() {
            document.getElementById('display-area').innerHTML = fetchedProducts.map(p => {
                const isSelected = selectedItems.find(item => item.no === p.no);
                return `
                <div class="relative bg-white border border-gray-200 rounded-2xl overflow-hidden cursor-pointer p-3 transition-all ${isSelected ? 'selected-card' : 'hover:shadow-md'}" onclick="toggleItem('${p.no}', this)">
                    <div class="check-badge"><i class="fa-solid fa-check text-xs"></i></div>
                    <img src="${p.img}" class="w-full aspect-square object-cover rounded-xl mb-3" style="width:150px; height:150px; margin: 0 auto; display:block;">
                    <div class="text-left">
                        <p class="text-[10px] text-gray-400 font-bold">#${p.no}</p>
                        <p class="text-[13px] font-bold text-gray-800 line-clamp-2 h-9 leading-tight mb-2">${p.title}</p>
                        <p class="text-dome font-black text-[15px]">${p.price}원</p>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleItem(no, el) {
            const index = selectedItems.findIndex(i => i.no === no);
            if(index > -1) { 
                selectedItems.splice(index, 1); 
                el.classList.remove('selected-card'); 
            } else { 
                selectedItems.push(fetchedProducts.find(p => p.no === no)); 
                el.classList.add('selected-card'); 
            }
            updateBar();
        }

        function updateBar() {
            const bar = document.getElementById('action-bar');
            document.getElementById('selected-count').innerText = selectedItems.length;
            if(selectedItems.length > 0) {
                bar.classList.remove('hidden', 'translate-y-60');
                document.getElementById('selected-list').innerHTML = selectedItems.map(item => `
                    <div class="w-12 h-12 flex-shrink-0 rounded-xl overflow-hidden border-2 border-white/20 shadow-md">
                        <img src="${item.img}" class="w-full h-full object-cover">
                    </div>`).join('');
            } else { bar.classList.add('translate-y-60'); }
        }

        function generateTableShowcase() {
            document.getElementById('editor-step').classList.add('hidden');
            document.getElementById('action-bar').classList.add('hidden');
            document.getElementById('showcase-view').classList.remove('hidden');
            
            // 메인 제목 중앙 정렬, 리스트 좌측 정렬(Hybrid)
            let html = `<div style="width:100%;max-width:1100px;margin:0 auto;background:#ffffff;padding:20px 0;font-family:'Malgun Gothic',sans-serif;text-align:center;">
                <h2 style="font-size:28px;color:#111;font-weight:800;margin-bottom:30px;">공급사 추천 상품 쇼케이스</h2>
                <div style="font-size:0; text-align:left; display:block; width:100%;">`; 

            selectedItems.forEach(item => {
                html += `
                <div style="display:inline-block; vertical-align:top; width:46%; max-width:180px; min-width:140px; margin:8px; box-sizing:border-box; background:#ffffff; border:1px solid #eee; border-radius:15px; overflow:hidden; text-align:left;">
                    <a href="https://domeggook.com/${item.no}" target="_blank" style="text-decoration:none; display:block;">
                        <div style="width:100%; position:relative; padding-top:100%; background:#f9f9f9;">
                            <img src="${item.img}" style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover;">
                        </div>
                        <div style="padding:12px;">
                            <div style="font-size:10px; color:#aaa; margin-bottom:4px; font-weight:bold;">ITEM NO. ${item.no}</div>
                            <div style="font-size:13px; color:#333; height:36px; overflow:hidden; font-weight:bold; line-height:1.4; margin-bottom:12px;">${item.title}</div>
                            <div style="font-size:18px; color:#329946; font-weight:800;">${item.price}<span style="font-size:12px; color:#111; font-weight:normal;">원</span></div>
                        </div>
                    </a>
                </div>`;
            });

            html += `</div></div>`;
            document.getElementById('table-container').innerHTML = html;
        }

        function goBackToEditor() { 
            document.getElementById('showcase-view').classList.add('hidden'); 
            document.getElementById('editor-step').classList.remove('hidden'); 
            updateBar(); 
        }
        
        function copyTableHtml() { 
            const html = document.getElementById('table-container').innerHTML; 
            const blob = new Blob([html], {type: 'text/html'});
            navigator.clipboard.writeText(html.trim()).then(() => { 
                alert('쇼케이스 HTML 코드가 복사되었습니다. 상세페이지 에디터(HTML 모드)에 붙여넣으세요.'); 
            }); 
        }
    </script>
</body>
</html>
